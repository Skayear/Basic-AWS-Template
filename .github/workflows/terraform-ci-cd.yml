name: AWS CI/CD

on:
  push:
    branches:
      - main

jobs:
    tfsec:
      name: tfsec sarif report
      runs-on: ubuntu-latest
      permissions:
        actions: read
        contents: read
        security-events: write

      steps:
        - name: Clone repo
          uses: actions/checkout@v2
          with:
            persist-credentials: false

        - name: tfsec
          uses: aquasecurity/tfsec-sarif-action@v0.1.0
          with:
            sarif_file: tfsec.sarif          

        - name: Upload SARIF file
          uses: github/codeql-action/upload-sarif@v1
          with:
            # Path to SARIF file relative to the root of the repository
            sarif_file: tfsec.sarif

        - name: Checkout Repository
          uses: actions/checkout@v2

        - name: Run TFLint
          run: tflint

#    - name: Terraform Plan
#      run: terraform plan

#  terraform-cd:
#    runs-on: ubuntu-latest

 #   steps:
 #   - name: Checkout Repository
 #     uses: actions/checkout@v2

 #   - name: Terraform Apply
 #     run: terraform apply -var "aws_credentials=$AWS_CREDENTIALS" --auto-approve
